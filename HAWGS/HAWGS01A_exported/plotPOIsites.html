<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <title>plotPOIsites</title>
  <link rel="stylesheet" href="css/coffeegrinder.min.css">
  <link rel="stylesheet" href="css/wireframe-theme.min.css">
  <script>document.createElement( "picture" );</script>
  <script src="js/picturefill.min.js" class="picturefill" async="async"></script>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Creepster%7COswald">



  
   
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCRCIipacvl0PMGdIGho8_9KbnK-LUQvNo"></script>
  <script type="text/javascript" src="v3_ll_grat.js"></script>                                                                              

 
<script type="text/javascript">function goBack(){window.history.back()} </script>
 
<script type="text/javascript">

	function gmapPrint() {
		
		
	
		
  
  }
</script>    

                             
<script type="text/javascript">
	

  var map;
  var bounds; 
  var grid;              // added to handle grid
  var dsname;   
  var iconCount=0;
  var iconArray=["MapIcons/star.png","MapIcons/a.png","MapIcons/b.png","MapIcons/c.png","MapIcons/d.png","MapIcons/e.png", "MapIcons/f.png","MapIcons/g.png",
                                    "MapIcons/h.png","MapIcons/i.png","MapIcons/j.png","MapIcons/k.png","MapIcons/l.png","MapIcons/m.png","MapIcons/n.png", 
                                    "MapIcons/o.png","MapIcons/p.png","MapIcons/q.png","MapIcons/r.png","MapIcons/s.png","MapIcons/t.png", 
                                    "MapIcons/u.png","MapIcons/v.png","MapIcons/w.png","MapIcons/x.png","MapIcons/y.png","MapIcons/z.png","MapIcons/1.png", 
                                    "MapIcons/2.png","MapIcons/3.png","MapIcons/4.png","MapIcons/5.png","MapIcons/5.png","MapIcons/6.png","MapIcons/7.png",
                                    "MapIcons/8.png","MapIcons/9.png","MapIcons/10.png"];
                                                                                          
                                                                                          
                                                                                          
  
                                                                                
                                                                                            
                                                                                           
  
  var GET = {};                                                              
  var query = window.location.search.substring(1).split("&");                
  for (var i = 0, max = query.length; i < max; i++)                          
  {                                                                          
      if (query[i] === "") // check for trailing & with no param             
          continue;                                                          
                                                                             
      var param = query[i].split("=");                                       
      GET[decodeURIComponent(param[0])] = decodeURIComponent(param[1] || "");
  }                                                                          

    
    
    
//alert('got id as ' + query);
//alert('try: '+ param);  

//alert("try2: " + GET["DesiredSite"]);  
var DesiredSite=GET["DesiredSite"];   
    

function initialize()
{
  geocoder=new google.maps.Geocoder();
  
   // Resize stuff...
   google.maps.event.addDomListener(window, "resize", function() {
   var center = map.getCenter();
   google.maps.event.trigger(map, "resize");
   map.setCenter(center); 
     
 });   
   bounds = new google.maps.LatLngBounds(); 
   
  
   searchLocations('Calgary, Alberta',200);
        
  
  
}



//function loadScript()    **** was the original loading function ****                                                                                                                 
//{                                                                                                                                        
//                                                                                                                                         
//  var script = document.createElement("script");                                                                                         
//  script.type = "text/javascript";                                                                                                       
//  script.src = "http://maps.googleapis.com/maps/api/js?key=AIzaSyCRCIipacvl0PMGdIGho8_9KbnK-LUQvNo&callback=initialize";                 
//                                                                                                                                         
//                                                                                                                                         
//  document.body.appendChild(script);                                                                                                                                                                                                         
//                                                                                                                                         
//                                                                                                                                         
//                                                                                                                                         
//} 
                                                                                                                                       
function processLocation(){
	   var address = document.getElementById('addressInput').value;
	  
	   var radius = document.getElementById('radiusSelect').value;
	   
	    searchLocations(address,radius);
	   
	   
	  } 



 function searchLocations(address,radius) {
     
     geocoder.geocode({address:address}, function(results, status) {
     	
 // add the check that resulting address search was ok 
 // also add what happens if the user decides to enter long,lat or system has long lats
     	
     	  
        
        
         getPlotPOIs();
        
     	
//     alert(status + latitude + longitude + radius);	
    });
     
   }
   
   
   
     function getPlotPOIs() {
//     alert('got to searchLocationsNear');
     var searchUrl = 'http://www.kenspon.com/HAWGS/DiveSites/SIteList/phpPOIgenJSON.php?DesiredDiveSite='+DesiredSite;
//     alert('here: '+searchUrl);
    
     var req = new XMLHttpRequest(); 
//     alert('After req'); 
     req.open('GET', searchUrl,false);  
     req.onreadystatechange = function() {//Call a function when the state changes.  	
	    if(req.readyState == 4 && req.status == 200) {
//		   alert('response: '+req.responseText);
	   }
   }
     
      
     req.send(null);  

     var TestText;
     

//      window.alert('out' +req.responseText); 
     
     var jsonStr= req.responseText;
     
                                    
if(jsonStr.length !=0)                                                                
{    // alert('I got'+jsonStr); 
      
      var POIArray = JSON.parse(jsonStr); 
 
      
        
        
       
//      	alert('got after parse');   
      	
        var out=''; 
        
         var DiveSitePOIId;
         
                       
          var DiveSiteName;              
          var DiveSiteMajorName;          
          var DiveSiteMinorName;           
          var DiveSitePOITitle;              
          var DiveSitePOIType;                
          var DiveSitePOILat;                 
          var DiveSitePOILong;                
          var DiveSitePOINotes;
          var DiveSiteExactLong;
          var DiveSiteExactLat;             
                 

var latlng;                                                                                                                                                                                                                                                                                                                                                                                                                                    
var SiteNotes;                                                                                                                                                                                                                                                                                                                                                                                                                                 
var SiteInfo;                                                                                                                                                                                                                                                                                                                                                                                                                                  
var DrivingInfo;                                                                                                                                                                                                                                                                                                                                                                                                                                                
var OutputTable='<table>';                                                                                                                                                                                                                                                                                                                                                                                                                                      
    OutputTable=OutputTable+'<tr><th align="center">Point of Interest</th><th>Type</th><th>Description<br></th><th>Notes & Comments</tr>';                                                                                                                                                                                                                                                                     
var convert;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
var iconUse; 
//alert(' size is: '+ POIArray.length);                  



                                                                                                                                                                                                                                                                                                                                                                                                                            
         
//        alert(' size is: '+ POIArray.length);                                                                                                     
        for(i = 0; i < POIArray.length; i++) { 
              
//            alert('in loop: '+i);            
            DiveSitePOIId=POIArray[i].DiveSitePOIId;
            DiveSiteName=POIArray[i].DiveSiteName;
            DiveSiteMajorName=POIArray[i].DiveSiteMajorName;
            DiveSiteMinorName=POIArray[i].DiveSiteMinorName; 
            DiveSitePOITitle=POIArray[i].DiveSitePOITitle; 
            DiveSitePOIType=POIArray[i].DiveSitePOIType;
            DiveSitePOILat=POIArray[i].DiveSitePOILat; 
            DiveSitePOILong=POIArray[i].DiveSitePOILong;  
            DiveSitePOINotes=POIArray[i].DiveSitePOINotes; 
            DiveSiteExactLong=POIArray[i].DiveSiteExactLong;   
            DiveSiteExactLat=POIArray[i].DiveSiteExactLat;        
            
            
            
                 if(i==0)                                          
                   {                                                
                   dsname=DiveSiteName+'<br>'+DiveSiteMajorName+'<br>'+DiveSiteMinorName; 
                   
                   var wmm = new WorldMagneticModel();
                   var d = new Date();
                   var year = d.getFullYear();
                   var month= d.getMonth()/12;
                       month= month.toFixed(2);
                   var decNeed=Number(year)+Number(month);
//                   alert('dec year: '+decNeed);
           
                   
                   var dec = wmm.declination(0.0,DiveSiteExactLat, DiveSiteExactLong, decNeed); 
                   if(dec > 0){
                   	 Direction='E';
                   }
                   else
                   	{
                   		Direction='W';
                   	}	
                   dec = dec.toFixed(2);
                   document.getElementById("LocationDisplay").innerHTML= DiveSiteName+'<br> '+DiveSiteMajorName+'<br>'+DiveSiteMinorName+'<br>'+'Declination:&nbsp;'+dec+'&nbsp;&deg;&nbsp;'+Direction+'&nbsp;('+decNeed+')';                                              
                   init(DiveSiteExactLat,DiveSiteExactLong ,10);	  
                	                                                
                  } 
                  
           if(DiveSitePOIType=='Entry')
              {iconUse=iconArray[0];}
           else {iconCount++;iconUse=iconArray[iconCount];}                                                        
            
         
            out += "<tr><td>" + DiveSitePOIId + "</td><td>"  ; 
            
          
          	  
            SiteNotes = DiveSitePOITitle;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
//         window.alert('Notes: '+SiteNotes);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         putMarker(DiveSitePOILat,DiveSitePOILong,iconUse,SiteNotes,'');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 //        alert('here: '+DiveSiteName);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
         latlng = new google.maps.LatLng(DiveSitePOILat,DiveSitePOILong);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         bounds.extend(latlng);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
         map.fitBounds(bounds);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
         convert ='';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 //Build Site info link                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        SiteInfo='<img src="'+iconUse+'" alt="'+DiveSitePOIId+'" style="width:50px;">';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 //Build the driving directionw                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
//         DrivingInfo='<a href="http://maps.google.com/maps?saddr='+latitude+','+longitude+'&daddr='+DiveSiteExactLat+','+DiveSiteExactLong+'"target=_blank">'+convert+'</a>';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
         OutputTable=OutputTable+'<tr><td>'+SiteInfo+'</td><td>'+DiveSitePOIType+'</td><td>'+DiveSitePOITitle+'</td>'+'<td>'+DiveSitePOINotes+'</td></tr>';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
//        alert('built: '+out);  
    OutputTable=OutputTable+'</table>';
//    window.alert(OutputTable);
      document.getElementById("ResultsTable").innerHTML = OutputTable;
    
}
else
{

OutputTable='<table><tr><th>No Points of Interest found!<br> Check back later.</th></tr></table>';
//document.getElementById("ResultsTable").innerHTML = OutputTable;    
document.getElementById("LocationDisplay").innerHTML= OutputTable; 
		
}		
}    
   
   
function putMarker(latitude,longitude,markerImage,markerInfo,majorLocation){
	
//	    alert('at marker: '+latitude);
      var latlng = new google.maps.LatLng(latitude,longitude);	
	    var marker = new google.maps.Marker({
          position: latlng, 
          icon: markerImage,
          map: map, 
            title: majorLocation
        }); 
        
     var infoWindow=new google.maps.InfoWindow({
     	    content: markerInfo
     	  });
     	  
     marker.addListener('click',function(){
     	infoWindow.open(map,marker);
     });		     
        
}   
   
  
function init(latitude,longitude,zoomFactor) {
        var latlng = new google.maps.LatLng(latitude,longitude);

        var myOptions = {
          zoom: zoomFactor,
          center:  new google.maps.LatLng(latitude,longitude),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          scaleControl: true
          
          
        };
        map = new google.maps.Map(document.getElementById("googleMap"),myOptions);
 
        grid = new Graticule(map, true);        // turns grid on and off
       
 



        var marker = new google.maps.Marker({
          position: latlng, 
          map: map, 
            title:"Dive Site"
       }); 
    
    var infoWindow=new google.maps.InfoWindow({     
    	    content: dsname                       
    	  });                                         
    	                                              
    marker.addListener('click',function(){          
    	infoWindow.open(map,marker);                      
    });		                                          
         bounds.extend(latlng);
         map.fitBounds(bounds);
        
        
        
        
      }


function WorldMagneticModel (){

/* 2015 - 2020 coefficients from WMM.COF */

this.coff = [
"  1,  0,  -29438.5,       0.0,       10.7,        0.0",
"  1,  1,   -1501.1,    4796.2,       17.9,      -26.8",
"  2,  0,   -2445.3,       0.0,       -8.6,        0.0",
"  2,  1,    3012.5,   -2845.6,       -3.3,      -27.1",
"  2,  2,    1676.6,    -642.0,        2.4,      -13.3",
"  3,  0,    1351.1,       0.0,        3.1,        0.0",
"  3,  1,   -2352.3,    -115.3,       -6.2,        8.4",
"  3,  2,    1225.6,     245.0,       -0.4,       -0.4",
"  3,  3,     581.9,    -538.3,      -10.4,        2.3",
"  4,  0,     907.2,       0.0,       -0.4,        0.0",
"  4,  1,     813.7,     283.4,        0.8,       -0.6",
"  4,  2,     120.3,    -188.6,       -9.2,        5.3",
"  4,  3,    -335.0,     180.9,        4.0,        3.0",
"  4,  4,      70.3,    -329.5,       -4.2,       -5.3",
"  5,  0,    -232.6        0.0,       -0.2,        0.0",
"  5,  1,     360.1,      47.4,        0.1,        0.4",
"  5,  2,     192.4,     196.9,       -1.4,        1.6",
"  5,  3,    -141.0,    -119.4,        0.0,       -1.1",
"  5,  4,    -157.4,      16.1,        1.3,        3.3",
"  5,  5,       4.3,     100.1,        3.8,        0.1",
"  6,  0,      69.5,       0.0,       -0.5,        0.0",
"  6,  1,      67.4,     -20.7,       -0.2,        0.0",
"  6,  2,      72.8,      33.2,       -0.6,       -2.2",
"  6,  3,    -129.8,      58.8,        2.4,       -0.7",
"  6,  4,     -29.0,     -66.5,       -1.1,        0.1",
"  6,  5,      13.2,       7.3,        0.3,        1.0",
"  6,  6,     -70.9,      62.5,        1.5,        1.3",
"  7,  0,      81.6,       0.0,        0.2,        0.0",
"  7,  1,     -76.1,     -54.1,       -0.2,        0.7",
"  7,  2,      -6.8,     -19.4,       -0.4,        0.5",
"  7,  3,      51.9,       5.6,        1.3,       -0.2",
"  7,  4,      15.0,      24.4,        0.2,       -0.1",
"  7,  5,       9.3,       3.3,       -0.4,       -0.7",
"  7,  6,      -2.8,     -27.5,       -0.9,        0.1",
"  7,  7,       6.7,      -2.3,        0.3,        0.1",
"  8,  0,      24.0,       0.0,        0.0,        0.0",
"  8,  1,       8.6,      10.2,        0.1,       -0.3",
"  8,  2,     -16.9,     -18.1,       -0.5,        0.3",
"  8,  3,      -3.2,      13.2,        0.5,        0.3",
"  8,  4,     -20.6,     -14.6,       -0.2,        0.6",
"  8,  5,      13.3,      16.2,        0.4,       -0.1",
"  8,  6,      11.7,       5.7,        0.2,       -0.2",
"  8,  7,     -16.0,      -9.1,       -0.4,        0.3",
"  8,  8,      -2.0,       2.2,        0.3,        0.0",
"  9,  0,       5.4,       0.0,        0.0,        0.0",
"  9,  1,       8.8,     -21.6,       -0.1,       -0.2",
"  9,  2,       3.1,      10.8,       -0.1,       -0.1",
"  9,  3,      -3.1,      11.7,        0.4,       -0.2",
"  9,  4,       0.6,      -6.8,       -0.5,        0.1",
"  9,  5,     -13.3,      -6.9,       -0.2,        0.1",
"  9,  6,      -0.1,       7.8,        0.1,        0.0",
"  9,  7,       8.7,       1.0,        0.0,       -0.2",
"  9,  8,      -9.1,      -3.9,       -0.2,        0.4",
"  9,  9,     -10.5,       8.5,       -0.1,        0.3",
" 10,  0,      -1.9,       0.0,        0.0,        0.0",
" 10,  1,      -6.5,       3.3,        0.0,        0.1",
" 10,  2,       0.2,      -0.3,       -0.1,       -0.1",
" 10,  3,       0.6,       4.6,        0.3,        0.0",
" 10,  4,      -0.6,       4.4,       -0.1,        0.0",
" 10,  5,       1.7,      -7.9,       -0.1,       -0.2",
" 10,  6,      -0.7,      -0.6,       -0.1,        0.1",
" 10,  7,       2.1,      -4.1,        0.0,       -0.1",
" 10,  8,       2.3,      -2.8,       -0.2,       -0.2",
" 10,  9,      -1.8,      -1.1,       -0.1,        0.1",
" 10, 10,      -3.6,      -8.7,       -0.2,       -0.1",
" 11,  0,       3.1,       0.0,        0.0,        0.0",
" 11,  1,      -1.5,      -0.1,        0.0,        0.0",
" 11,  2,      -2.3,       2.1,       -0.1,        0.1",
" 11,  3,       2.1,      -0.7,        0.1,        0.0",
" 11,  4,      -0.9,      -1.1,        0.0,        0.1",
" 11,  5,       0.6,       0.7,        0.0,        0.0",
" 11,  6,      -0.7,      -0.2,        0.0,        0.0",
" 11,  7,       0.2,      -2.1,        0.0,        0.1",
" 11,  8,       1.7,      -1.5,        0.0,        0.0",
" 11,  9,      -0.2,      -2.5,        0.0,       -0.1",
" 11, 10,       0.4,      -2.0,       -0.1,        0.0",
" 11, 11,       3.5,      -2.3,       -0.1,       -0.1",
" 12,  0,      -2.0,       0.0,        0.1,        0.0",
" 12,  1,      -0.3,      -1.0,        0.0,        0.0",
" 12,  2,       0.4,       0.5,        0.0,        0.0",
" 12,  3,       1.3,       1.8,        0.1,       -0.1",
" 12,  4,      -0.9,      -2.2,       -0.1,        0.0",
" 12,  5,       0.9,       0.3,        0.0,        0.0",
" 12,  6,       0.1,       0.7,        0.1,        0.0",
" 12,  7,       0.5,      -0.1,        0.0,        0.0",
" 12,  8,      -0.4,       0.3,        0.0,        0.0",
" 12,  9,      -0.4,       0.2,        0.0,        0.0",
" 12, 10,       0.2,      -0.9,        0.0,        0.0",
" 12, 11,      -0.9,      -0.2,        0.0,        0.0",
" 12, 12,       0.0,       0.7,        0.0,        0.0"
];

/* static variables */

/* some 13x13 2D arrays */
this.c = new Array(13); 
this.cd = new Array(13); 
this.tc = new Array(13); 
this.dp = new Array(13); 
this.k = new Array(13); 

for(var i=0; i< 13; i++)
{
    this.c[i] = new Array(13); 
    this.cd[i] = new Array(13); 
    this.tc[i] = new Array(13); 
    this.dp[i] = new Array(13); 
    this.k[i] = new Array(13); 
}

/* some 1D arrays */
this.snorm = new Array(169); 
this.sp = new Array(13); 
this.cp = new Array(13); 
this.fn = new Array(13); 
this.fm = new Array(13); 
this.pp = new Array(13); 


/* locals */

var maxdeg = 12;
var maxord;
var i,j,D1,D2,n,m;
var a,b,a2,b2,c2,a4,b4,c4,re;
var gnm,hnm,dgnm,dhnm,flnmj;
var c_str;
var c_flds;

/* INITIALIZE CONSTANTS */

maxord = maxdeg;
this.sp[0] = 0.0;
this.cp[0] = this.snorm[0] = this.pp[0] = 1.0;
this.dp[0][0] = 0.0;
a = 6378.137;
b = 6356.7523142;
re = 6371.2;
a2 = a*a;
b2 = b*b;
c2 = a2-b2;
a4 = a2*a2;
b4 = b2*b2;
c4 = a4 - b4;

/* READ WORLD MAGNETIC MODEL SPHERICAL HARMONIC COEFFICIENTS */
this.c[0][0] = 0.0;
this.cd[0][0] = 0.0;

for(i=0; i<this.coff.length; i++)
{
  c_str = this.coff[i];
  c_flds = c_str.split(",");

  n = parseInt(c_flds[0],10);   
  m = parseInt(c_flds[1],10);   
  gnm = parseFloat(c_flds[2]);
  hnm = parseFloat(c_flds[3]);
  dgnm = parseFloat(c_flds[4]);
  dhnm = parseFloat(c_flds[5]);
     
  if (m <= n)
  {
	this.c[m][n] = gnm;
	this.cd[m][n] = dgnm;
	if (m != 0) 
	{
	  this.c[n][m-1] = hnm;
	  this.cd[n][m-1] = dhnm;
	}
  }
}

/* CONVERT SCHMIDT NORMALIZED GAUSS COEFFICIENTS TO UNNORMALIZED */

this.snorm[0] = 1.0;
for (n=1; n<=maxord; n++) 
{
    this.snorm[n] = this.snorm[n-1]*(2*n-1)/n;
    j = 2;
    for (m=0,D1=1,D2=(n-m+D1)/D1; D2>0; D2--,m+=D1) 
    {
        this.k[m][n] = (((n-1)*(n-1))-(m*m))/((2*n-1)*(2*n-3));
        if (m > 0) 
        {
        flnmj = ((n-m+1)*j)/(n+m);
        this.snorm[n+m*13] = this.snorm[n+(m-1)*13]*Math.sqrt(flnmj);
        j = 1;
        this.c[n][m-1] = this.snorm[n+m*13]*this.c[n][m-1];
        this.cd[n][m-1] = this.snorm[n+m*13]*this.cd[n][m-1];
        }
        this.c[m][n] = this.snorm[n+m*13]*this.c[m][n];
        this.cd[m][n] = this.snorm[n+m*13]*this.cd[m][n];
    }
    this.fn[n] = (n+1);
    this.fm[n] = n;
}
this.k[1][1] = 0.0;
this.fm[0] = 0.0;// !!!!!! WMM C and Fortran both have a bug in that fm[0] is not initialised 

}

WorldMagneticModel.prototype.declination = function(altitudeKm, latitudeDegrees, longitudeDegrees, yearFloat){
		


/* locals */

var a = 6378.137;
var b = 6356.7523142;
var re = 6371.2;
var a2 = a*a;
var b2 = b*b;
var c2 = a2-b2;
var a4 = a2*a2;
var b4 = b2*b2;
var c4 = a4 - b4;
var D3, D4;
var dip, ti, gv, dec;
var n,m;
	  
var pi, dt, rlon, rlat, srlon, srlat, crlon, crlat,srlat2,
crlat2, q, q1, q2, ct, d,aor,ar, br, r2, bpp, par,
temp1,parp,temp2,bx,by,bz,bh,dtr,bp,bt, st,ca,sa;

var maxord = 12;
var alt = altitudeKm;
var glon = longitudeDegrees;
var glat = latitudeDegrees;

/*************************************************************************/

dt = yearFloat - 2015.0;
//if more then 5 years has passed since last epoch update then return invalid
if ((dt < 0.0) || (dt > 5.0)) 
    return -999;


pi = 3.14159265359;
dtr = pi/180.0;
rlon = glon*dtr;
rlat = glat*dtr;
srlon = Math.sin(rlon);
srlat = Math.sin(rlat);
crlon = Math.cos(rlon);
crlat = Math.cos(rlat);
srlat2 = srlat*srlat;
crlat2 = crlat*crlat;
this.sp[1] = srlon;
this.cp[1] = crlon;

/* CONVERT FROM GEODETIC COORDS. TO SPHERICAL COORDS. */

q = Math.sqrt(a2-c2*srlat2);
q1 = alt*q;
q2 = ((q1+a2)/(q1+b2))*((q1+a2)/(q1+b2));
ct = srlat/Math.sqrt(q2*crlat2+srlat2);
st = Math.sqrt(1.0-(ct*ct));
r2 = (alt*alt)+2.0*q1+(a4-c4*srlat2)/(q*q);
r = Math.sqrt(r2);
d = Math.sqrt(a2*crlat2+b2*srlat2);
ca = (alt+d)/r;
sa = c2*crlat*srlat/(r*d);

for (m=2; m<=maxord; m++)
{
    this.sp[m] = this.sp[1]*this.cp[m-1]+this.cp[1]*this.sp[m-1];
    this.cp[m] = this.cp[1]*this.cp[m-1]-this.sp[1]*this.sp[m-1];
}
     
aor = re/r;
ar = aor*aor;
br = bt = bp = bpp = 0.0;

for (n=1; n<=maxord; n++) 
{
    ar = ar*aor;
    for (m=0,D3=1,D4=(n+m+D3)/D3; D4>0; D4--,m+=D3) 
    {
        /*
           COMPUTE UNNORMALIZED ASSOCIATED LEGENDRE POLYNOMIALS
           AND DERIVATIVES VIA RECURSION RELATIONS
        */
            
          
        if (n == m) 
        {
          this.snorm[n+m*13] = st*this.snorm[n-1+(m-1)*13];
          this.dp[m][n] = st*this.dp[m-1][n-1]+ct*this.snorm[n-1+(m-1)*13];
        }
        else if (n == 1 && m == 0) 
        {
          this.snorm[n+m*13] = ct*this.snorm[n-1+m*13];
          this.dp[m][n] = ct*this.dp[m][n-1]-st*this.snorm[n-1+m*13];
        }
        else if (n > 1 && n != m) 
        {
          if (m > n-2) this.snorm[n-2+m*13] = 0.0;
          if (m > n-2) this.dp[m][n-2] = 0.0;
          this.snorm[n+m*13] = ct*this.snorm[n-1+m*13]-this.k[m][n]*this.snorm[n-2+m*13];
          this.dp[m][n] = ct*this.dp[m][n-1] - st*this.snorm[n-1+m*13]-this.k[m][n]*this.dp[m][n-2];
         }
         
        /*
        TIME ADJUST THE GAUSS COEFFICIENTS
        */
        this.tc[m][n] = this.c[m][n]+dt*this.cd[m][n];
        if (m != 0) this.tc[n][m-1] = this.c[n][m-1]+dt*this.cd[n][m-1];
        
        /*
        ACCUMULATE TERMS OF THE SPHERICAL HARMONIC EXPANSIONS
        */
        par = ar*this.snorm[n+m*13];
        if (m == 0) 
        {
            temp1 = this.tc[m][n]*this.cp[m];
            temp2 = this.tc[m][n]*this.sp[m];
        }
        else 
        {
            temp1 = this.tc[m][n]*this.cp[m]+this.tc[n][m-1]*this.sp[m];
            temp2 = this.tc[m][n]*this.sp[m]-this.tc[n][m-1]*this.cp[m];
        }
        bt = bt-ar*temp1*this.dp[m][n];
        bp += (this.fm[m]*temp2*par);
        br += (this.fn[n]*temp1*par);
        /*
        SPECIAL CASE:  NORTH/SOUTH GEOGRAPHIC POLES
        */
        if (st == 0.0 && m == 1) 
        {
            if (n == 1) this.pp[n] = this.pp[n-1];
            else this.pp[n] = this.ct*this.pp[n-1]-this.k[m][n]*this.pp[n-2];
            parp = ar*this.pp[n];
            bpp += (this.fm[m]*temp2*parp);
        }
    }
}

if (st == 0.0) 
    bp = bpp;
else 
    bp /= st;
    
/*
    ROTATE MAGNETIC VECTOR COMPONENTS FROM SPHERICAL TO
    GEODETIC COORDINATES
*/
bx = -bt*ca-br*sa;
by = bp;
bz = bt*sa-br*ca;
/*
    COMPUTE DECLINATION (DEC), INCLINATION (DIP) AND
    TOTAL INTENSITY (TI)
*/
bh = Math.sqrt((bx*bx)+(by*by));
ti = Math.sqrt((bh*bh)+(bz*bz));
dec = Math.atan2(by,bx)/dtr;
dip = Math.atan2(bz,bh)/dtr;
/*
    COMPUTE MAGNETIC GRID VARIATION IF THE CURRENT
    GEODETIC POSITION IS IN THE ARCTIC OR ANTARCTIC
    (I.E. GLAT > +55 DEGREES OR GLAT < -55 DEGREES)

    OTHERWISE, SET MAGNETIC GRID VARIATION TO -999.0
*/
gv = -999.0;
if (Math.abs(glat) >= 55.0) 
{
    if (glat > 0.0 && glon >= 0.0) gv = dec-glon;
    if (glat > 0.0 && glon < 0.0) gv = dec+Math.abs(glon);
    if (glat < 0.0 && glon >= 0.0) gv = dec+glon;
    if (glat < 0.0 && glon < 0.0) gv = dec-Math.abs(glon);
    if (gv > +180.0) gv -= 360.0;
    if (gv < -180.0) gv += 360.0;
}
      
return dec;
}

function plotDiveRoute(){
	
	
	
	window.open("http://www.kenspon.com/HAWGS/DynamicTableA.html?DesiredSite="+DesiredSite);
	
	
	
	}
 





window.onload =initialize;
// originally window.onload = loadscript;
  


</script>

 







<style>
    
  
    #googleMap {
    	  position: absolute;
    	  padding-top: 350px;
    	  max-width: 1085px;
    	  max-height:380px;
    	  width: 89%;
    	  height: 100%;
    	  z-index: 5;
    	  margin: auto;
    	 
    	  
    }	  
    
   #ResultsTable{
   	   position: relative;
   	   padding-top:400px;
   	   max-width: 800px;
   	   width:100%;
   	   margin:auto;
   	  
   }
   
   #ResultsTable table{
   	  
   	     border: solid #000000 2px;
  }
  
  #ResultsTable th{
   	  
   	     border: solid #000000 1px;
  }
  
  #ResultsTable td{
   	  
   	     border: solid #000000 1px;
  }
  
  #ResultsTable tr:nth-child(even) {
    background-color: #FFFFFF;
}
   
   

   #Search{                    
   	                           
   	   top: 0px;               
   	   max-width: 400px;       
   	   width: 100%;            
   	   height:100%; 
   	   margin: auto;           
	                             
  }                            
                               










  
  
  
  
  
  #All{
  	  position: absolute;
  	  max-width: 1100px;
  	  width: 100%;
  	 
  	  background-color: WHITE;
  	
  }
    	
</style>


<style type="text/css">     
    select {
        width:120px;
    }
</style>

<style>                                                                                
     @media screen and (max-width: 768px) {#menu.show {display: block;}}                                                                                
</style>                                                                             


  </head>
                                                                                       
<body class="grid-1">
  <div class="row">
    <div class="coffee-span-22 coffee-offset-1 column-1">
      <h1 class="heading-1"><span class="heading-text-2">H.A.W.G.S.</span>
      </h1>
    </div>
  </div>
  <div class="row">
    <div class="coffee-span-22 coffee-offset-1 column-2">
      <div class="subgrid">
        <div class="row">
          <div class="coffee-span-24 mobile-button"><span class="glyph mobile-icon"><i class="coffeecup-icons-menu3"></i></span>
            <span class="text-element menu-label">MENU</span>
          </div>
          <div class="coffee-span-24 menu" id="menu">
            <div class="container pulldown">
              <a class="link-text first-level-button" href="index.html">HOME</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
            <div class="container pulldown">
              <a class="link-text first-level-button" href="#">LOGIN</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200"><a href="login.html">MEMBERS<br></a>
                </li>
                <li class="list-item-link submenu-li" id="Registration"><a href="registration.html">Registration<br></a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
            <div class="container pulldown">
              <a class="link-text first-level-button" href="#">DIVE SITES</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200" id="FindSite"><a href="findsite.html">FIND A Dive site<br></a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
            <div class="container pulldown">
              <a class="link-text first-level-button" href="#">BUDDIES</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
            <div class="container pulldown">
              <a class="link-text first-level-button" href="contact.html">CONTACT</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
            <div class="container pulldown">
              <a class="link-text first-level-button" href="about.html">ABOUT</a>
              <ul class="link-list submenu">
                <li class="list-item-link submenu-li w200"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
                <li class="list-item-link submenu-li"><a href="#">SubMENU BUTTON</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">


    <div class="coffee-span-22 column-3 coffee-offset-1">
	
<div id="Search">	
<center>	
<h3>Points of Interest</h3>
<h5 id="LocationDisplay">"TBD"</h5> 
                                                      
<input type="button" value="Back" onclick="goBack()" />
<input type="button" value="Plot Dive Route" onclick="plotDiveRoute()" />




</center>


    
    <br> <br> 
</div> 



     
    
    
    
    
    
    
    
 
 
 
 <div id="googleMap"></div>


 <div id="ResultsTable"></div>   	
    	
    </div>
  </div>

  <script src="js/jquery-1.11.0.min.js"></script>
<script>
   $(document).ready(function() {
      $(".mobile-button").click(function() {
         $("#menu").slideToggle('fast', function() {
            $(this).attr('style', '').toggleClass('show');
         });
         $(this).toggleClass('active');
      });
   });
</script>

<script type="text/javascript">
   $(".pulldown").hover(function() {
      $(this).children('ul').slideToggle("fast");
   });
   $(".submenu").click(function(event) {
      event.stopPropagation();
   });
</script>
</body>

</html>